
html {
    overflow-y: scroll;
}

#img {
    object-fit: cover;
    width: 400px;
    height: 100%;
}
#imgDiv {
    /* other styles */
    -webkit-transition: all 1s ease-in-out;
    transition: all 1s ease-in-out;
    text-align: center;
}

#propertiesList {
    margin: 0;
    padding: 0;
    list-style-type: none;
}
#propertiesList input {
    border: 2px solid #008000;
    width: 230px;
    /* border: 2px solid #456879; */
    border-radius:10px;
    height: 22px;
}
#propertiesList input:focus {
    outline: none;
}
#propertiesList div {
    display: inline-block;
}
#propertiesList label {
    display: block;
    text-align: center;
}
.property_confirmed {
    background-color : #99FFCC;
}
.property_loading {
    background-color : #FFFF50;
}
.property_failed {
    background-color : red;
}

/* Table */
.table-fill {
    background: white;
    border-radius:3px;
    border-collapse: collapse;
    width: 100%;
    padding:5px;
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
    animation: float 5s infinite;
}
th {
    color:#D5DDE5;;
    background:#1b1e24;
    border-bottom:4px solid #9ea7af;
    border-right: 1px solid #343a45;
    font-size:23px;
    font-weight: 100;
    padding:24px;
    text-align:left;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
    vertical-align:middle;
}
tr {
    border-top: 1px solid #C1C3D1;
    border-bottom: 1px solid #C1C3D1;
    color:#666B85;
    font-size:16px;
    font-weight:normal;
    text-shadow: 0 1px 1px rgba(256, 256, 256, 0.1);
}
tr:hover td {
    background:#4E5066;
    color:#FFFFFF;
    border-top: 1px solid #22262e;
}
tr:nth-child(odd) td {
    background:#EBEBEB;
}
tr:nth-child(odd):hover td {
    background:#4E5066;
}
td {
    background:#FFFFFF;
    padding:20px;
    text-align:left;
    vertical-align:middle;
    font-weight:300;
    font-size:18px;
    text-shadow: -1px -1px 1px rgba(0, 0, 0, 0.1);
    border-right: 1px solid #C1C3D1;
}

/* Menu */
#menu {
    display: grid;
    color: red;
    width: 100%;
    height: 100px;
    background-color: #abcdef;
    grid-template-columns: auto repeat(3, 80px) 40px;
    font-family: 'Montserrat', Helvetica, sans-serif;
}
#menuOptionCamera { grid-column: 2; }
#menuOption2 {      grid-column: 3; }
#menuOption3 {      grid-column: 4; }
#menu button:active {
    -webkit-animation: active 1200ms ease 1 alternate;
    animation: active 1200ms ease 1 alternate;
    background: #5F9BE0;
}
#menu button {
    background: #76B3FA;
    border-radius: 50px;
    color: #fff;
    text-decoration: none;
    font-size: 1em;
    margin: 5%;
}
#menu button:focus {
    outline: none;
}
#menu .gray { background: #D2D2D2; }
#menu .gray:active { background: #b9b9b9; }

#content {
    margin: 0 2%;
}

@media(min-width: 550px) {
    #img {
        width: 500px;
    }
}

/* DESKTOP VERSION */
@media(min-width: 768px) {
    #tables {
        display: grid;
        grid-template-columns: 50% 50%;
    }

    .table-fill {
        grid-column: 1;
    }

    #propertiesList {
        grid-column: 2;
    }

    #menu button {
        border-radius: 100px;
        font-size: 1.45em;
    }

    #menu {
        display: grid;
        color: red;
        width: 100%;
        height: 100px;
        background-color: #abcdef;
        grid-template-columns: auto repeat(3, 200px) 100px;
        font-family: 'Montserrat', Helvetica, sans-serif;
    }

    #img {
        width: 700px;
    }
}

@media(min-width: 850px) {
    #img {
        width: 800px;
    }
}

/* Background */
body {
    background-color: #7373D3;
    background-image: linear-gradient(0deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent), linear-gradient(90deg, transparent 24%, rgba(255, 255, 255, .05) 25%, rgba(255, 255, 255, .05) 26%, transparent 27%, transparent 74%, rgba(255, 255, 255, .05) 75%, rgba(255, 255, 255, .05) 76%, transparent 77%, transparent);
    background-size:50px 50px;
}

</style>
</head>
<body>

<div id='menu'>
    <button id='menuOptionCamera' onclick="cameraImage.slideToggle()">Hide camera</button>
    <button id='menuOption2'>Some image</button>
    <button id='menuOption3'>Some text</button>
</div>

<div id="content">
    <!--CONTENT-->
    <div id="FPS_Div"></div>
    <div id="imgDiv">
        <img id='img' src="" alt="Camera Image">
    </div>

    <div id="tables">
    <table class="table-fill">
        <thead>
        <tr>
            <th>Property</th>
            <th>Value</th>
        </tr>
        </thead>
        <tbody class="table-hover">
        <tr>
            <td>Roll</td>
            <td id = "RollDiv"></td>
        </tr>
        <tr>
            <td>Pitch</td>
            <td id = "PitchDiv"></td>
        </tr>
        <tr>
            <td>Yaw</td>
            <td id = "YawDiv"></td>
        </tr>
        </tbody>
    </table>
    <ul id="propertiesList">
        <li>
            <div>
                <label>Property 1</label>
                <input id="property1" class="property_confirmed" type="number">
            </div>
        </li>
        <li>
            <div>
                <label>Property 2</label>
                <input id="property2" class="property_loading" type="number">
            </div>
        </li>
        <li>
            <div>
                <label>Property 3</label>
                <input id="property3" class="property_failed" type="number">
            </div>
        </li>
    </ul>
    </div>
    <!--/CONTENT-->
</div>

<script>

<!--INDEX.TEMPLATE.HTML is generated automatically, change files in HTML, CSS and JS folders instead-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <title>%s title</title>
    <!--CSS-->
    <style>

</script>
</body>
</html>

let statsLoaded = true;
let fps = 0;

let cameraImage = {
    displaying: true,
    heightChecked: false,
    initHeight : 0,
    slideToggle: function () {
        if (!this.div) {
            this.div = document.getElementById('imgDiv');
            this.div.style.height = `${this.div.offsetHeight}px`;
        }
        if (!this.button) {
            this.button = document.getElementById('menuOptionCamera');
        }
        if (!this.heightChecked) {
            this.initHeight = this.div.offsetHeight;
            this.heightChecked = true;
        }
        if (this.displaying) {
            this.button.innerHTML = 'Show camera';
            this.button.classList.add('gray');
            this.displaying = false;
            this.div.style.height = '0px';
        } else {
            this.button.innerHTML = 'Hide camera';
            this.button.classList.remove('gray');
            this.displaying = true;
            this.div.style.height = `${this.initHeight}px`;
        }
    }
}

function onLoad() {
    function recursive_Ajax(url, func) { return send_Ajax(url, func, true); }
    function send_Ajax(url, func, recursive = false) {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', url, true);
        xhr.onload = function() {
            if (this.status === 200) {
                func(this.responseText);
                if (recursive) send_Ajax(url, func, true);
            }
        };
        xhr.send();
    }

    setInterval(_ => {
        if (statsLoaded) {
            statsLoaded = false;
            send_Ajax('stats_request', data => {
                const arr = data.split('$');
                document.getElementById('RollDiv').innerHTML = arr[0];
                document.getElementById('PitchDiv').innerHTML = arr[1];
                document.getElementById('YawDiv').innerHTML = arr[2];
                statsLoaded = true;
            })
        }
    }, 250);

    recursive_Ajax('image_request', data => {
        document.getElementById('img').setAttribute('src', `data:image/png;base64,${data}`);
        fps++;
    });

    setInterval(_ => { console.log(`FPS: ${fps}`); document.getElementById('FPS_Div').innerHTML = `FPS:${fps}`; fps = 0; }, 1000);
}

(function(fn){
    if (document.readyState !== 'loading') {
        fn();
    } else {
        document.addEventListener('DOMContentLoaded', fn);
    }
})(onLoad)
